<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>ESF Task Tree 2025 — v13.8 (Delivery)</title>
<style>
/* Aptos embed (if provided) */
@font-face{font-family:'Aptos';src:local('Aptos');font-weight:100 900;font-style:normal;font-display:swap}

:root{--brand:var(--brand-orange);--soft:#FFE6D4;--bg:var(--brand-white);--ink:#101114;--line:#ececf1;--thead-top:196px;--side-w:300px;--header-h:104px}
html,body{height:100%;background:var(--bg);color:var(--ink);
  font-family:"Aptos","Segoe UI",Inter,Roboto,Helvetica,Arial,sans-serif;font-size:14px;line-height:1.55;overflow-x:hidden}
*{box-sizing:border-box}
.header{position:sticky;top:0;z-index:20;background:linear-gradient(to bottom,var(--bg) 85%,transparent);
  padding:12px 20px 8px;border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(4px)}
.brand{display:flex;align-items:center;gap:16px}
.brand .logo{height:80px;width:auto;object-fit:contain;display:block}
.h1{font-size:30px;font-weight:900;letter-spacing:.4px;text-transform:uppercase}
.h2{font-size:12px;font-weight:800;letter-spacing:.25px;text-transform:uppercase;opacity:.85}
.kpis{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.kpi{background:var(--soft);border:2px solid var(--brand);border-radius:999px;padding:8px 12px;font-weight:900;font-size:12px;text-transform:uppercase}
.dash{margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.badge{border:2px solid var(--brand);background:var(--soft);border-radius:14px;padding:8px 12px;font-weight:900;text-transform:uppercase}
.badge.high{background:rgba(244,124,38,.12);border-color:var(--brand)}
.badge.med{background:#f0f0ff;border-color:#b6b6ff}
.badge.low{background:#eef9f0;border-color:#9ad0a9}
.filters{position:sticky;top:var(--header-h);z-index:99;background:var(--bg);}
.filters .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.filters .input-group{display:flex;gap:8px;align-items:center;flex:1 1 380px;min-width:320px}
input[type="search"], select, .btn{appearance:none;border:2px solid var(--brand);background:var(--soft);color:var(--ink);
  border-radius:14px;padding:10px 12px;outline:none;font-weight:900;text-transform:uppercase}
input[type="search"]{text-transform:none;font-weight:800;min-width:220px;flex:1}
select{flex:0 1 170px}
.btn{cursor:pointer;white-space:nowrap}
.btn.primary{background:var(--brand);color:var(--brand-white)}
.actions-right{margin-left:auto;display:flex;gap:8px;flex:0 0 auto}
.chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.chip{border:2px solid var(--brand);background:var(--brand-white);border-radius:999px;padding:4px 10px;font-weight:900;display:inline-flex;gap:8px;align-items:center}
.chip button{border:none;background:transparent;cursor:pointer;font-weight:900}
.wrap{display:grid;grid-template-columns:var(--side-w) 1fr;gap:14px;max-width:1720px;margin:0 auto;padding:12px 20px 24px}
@media (max-width:1400px){
  .filters .input-group{flex:1 1 100%;min-width:100%}
  select{flex:1 1 200px}
  .actions-right{flex:1 1 100%;justify-content:flex-end}
}
@media (max-width:1200px){:root{--side-w:1fr}.wrap{grid-template-columns:1fr} .sidenav{position:static;max-height:none}}
.sidenav{position:sticky;top:calc(80px + 120px);max-height:calc(100vh - 216px);overflow:auto;border:2px solid var(--brand);border-radius:16px;padding:12px;background:var(--soft);
  display:flex;flex-direction:column}
.sidenav .ttl{font-size:18px;font-weight:900;letter-spacing:.2px;text-transform:uppercase;margin:4px 6px 12px}
.tree{list-style:none;margin:0;padding:6px;flex:1 1 auto}
.node{margin:12px 0}
.proc{display:flex;align-items:center;gap:10px;padding:12px;border:2px solid var(--brand);border-radius:12px;background:var(--brand-white);font-weight:900;text-transform:uppercase;cursor:pointer}
.proc .ico{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;flex:0 0 20px}
.proc .ico svg{width:20px;height:20px;stroke:currentColor;fill:none;stroke-width:2}
/* Keep search visible: this is a primary workflow entry point */
.filters .input-group{display:flex!important}
.proc.active{background:var(--brand);color:var(--brand-white)}
.subs{margin:6px 0 6px 12px;display:none}
.sub{display:block;padding:6px 10px;border:2px solid var(--brand);border-radius:10px;background:var(--brand-white);margin:6px 0;font-weight:800;cursor:pointer}
.sub.active{background:var(--brand);color:var(--brand-white)}
.sidenav-footer{margin-top:auto;padding:10px;border-top:1px dashed var(--brand);display:flex;gap:10px;align-items:center;justify-content:center;opacity:.9}
.sidenav-footer .pw{font-weight:900;letter-spacing:.4px;font-size:11px}
.sidenav-footer img{height:24px;width:auto;object-fit:contain}
.content{display:flex;flex-direction:column;gap:8px}
.toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
.count{font-weight:900;text-transform:uppercase}
.tools-right{display:flex;gap:8px;align-items:center}
.table{width:100%;border-collapse:separate;border-spacing:0;table-layout:fixed}
col.col-task{width:54%}
col.col-freq{width:10%}
col.col-imp{width:12%}
col.col-owner{width:12%}
col.col-exec{width:12%}
.thead th{position:sticky;top:var(--thead-top);z-index:6;background:#fbfbfd;border-bottom:1px solid var(--line);text-align:left;
  padding:12px 12px;font-size:13px;color:#101114;text-transform:uppercase;font-weight:900}
.sub-header{position:sticky;top:calc(var(--thead-top) - 32px);z-index:7;background:#fffbe6;border:1px solid #f5e8b3;border-left:none;border-right:none;padding:6px 12px;font-weight:900;letter-spacing:.2px}
.tbody tr{page-break-inside: avoid}
.tbody td{padding:12px;border-bottom:1px solid var(--line);vertical-align:top;overflow-wrap:anywhere;white-space:normal;line-height:1.6}
.cell-task-title{font-weight:900;font-size:18px;text-transform:none;font-family:"Aptos","Segoe UI",Inter,Roboto,Helvetica,Arial,sans-serif}
.desc-ul{list-style:none;padding-left:0;margin:6px 0 0 0;columns:1;column-gap:24px}
.desc-ul.two-col{columns:2}
.desc-ul li{position:relative;padding-left:22px;margin:12px 0;font-size:16px;break-inside:avoid}
.desc-ul li::before{content:"✓";position:absolute;left:0;top:0;line-height:1;color:var(--brand);font-weight:900}
.row-high td{background:rgba(244,124,38,.06)}
.hidden{display:none!important}
.td-tight{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
@page{size:A4 landscape;margin:8mm}
.print-meta{display:none}
@media print{
  .sidenav,.filters,.kpis,.dash,.toolbar{display:none!important}
  .wrap{grid-template-columns:1fr;max-width:none}
  .thead th{position:static}
  .sub-header{position:static;border:0;background:var(--brand-white); padding:0 0 6px 0; font-size:12px}
  .tbody td{padding:8px 8px 10px 8px}
  .desc-ul{columns:2}
  .desc-ul li{margin:6px 0;font-size:14px}
  .cell-task-title{font-size:14px}
  .print-meta{display:block;margin-top:6px;font-size:11px;color:#444}
}
.proc:focus,.sub:focus,button:focus,select:focus,input:focus{outline:3px solid rgba(244,124,38,.5);outline-offset:2px;border-radius:12px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:50}
.overlay .panel{background:var(--brand-white);border-radius:14px;max-width:840px;width:94%;padding:16px;border:2px solid var(--brand)}
.overlay h3{margin:0 0 10px 0;font-size:18px}
.overlay pre{background:#fbfbfd;border:1px solid #eee;border-radius:10px;padding:10px;max-height:40vh;overflow:auto}
.overlay .close{margin-top:12px}

/* Processes icons color tweak */
.processes .icon, .processes [data-icon], .proc-item .icon, .proc .icon, .proc svg, .process-list .icon, .process-list svg {
  color: var(--brand-orange);
  stroke: currentColor;
}

</style>
<style id="taskmgr-css-fix">
/* Strong modal isolation */
#tmgr-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(16,17,20,.5);backdrop-filter:blur(2px);z-index:9999}
#tmgr-overlay .panel{background:var(--brand-white);border:2px solid var(--brand,var(--brand-orange));border-radius:14px;max-width:1000px;width:96%;padding:16px;box-shadow:0 24px 80px rgba(0,0,0,.35);position:relative}
#tmgr-overlay .tmgr-title{font-size:18px;margin:0 0 8px 0;padding-right:36px}
#tmgr-overlay .tmgr-x{position:absolute;top:8px;right:8px;border:none;background:transparent;font-size:20px;line-height:1;cursor:pointer}
body.modal-open{overflow:hidden !important}
/* Button align + consistent look */
.btn.primary{background:var(--brand,var(--brand-orange));color:var(--brand-white)}
.btn{padding:8px 12px;border-radius:12px;border:2px solid var(--brand,var(--brand-orange));background:var(--brand-white);font-weight:900;text-transform:uppercase;cursor:pointer}
</style>
<style id="skills-modal-override">
/* Force modal overlay above everything */
#skills-modal{ z-index: 99999 !important; }
#skills-modal .panel{ z-index: 100000 !important; }
/* Prevent page scroll behind modal */
body.modal-open{ overflow: hidden !important; }
/* Make dropdown also top-most over headers */
#skills-dropdown{ z-index: 20000 !important; }
</style><style id="safe-overrides-step1">
/* === SAFE OVERRIDES (no logic change) === */
:root { --z-modal: 100000; }

/* Keep exact visual for Position Skills via class instead of inline */
.btn--skills { background:var(--brand-red); color:var(--brand-white); border-color:var(--brand-red); }

/* Modals always on top */
#skills-modal, #skills-positions { z-index: var(--z-modal) !important; }
#skills-modal .panel, #skills-positions .panel { z-index: calc(var(--z-modal) + 1) !important; }

/* Uniform icon size inside skills/positions popups */
#skills-list svg, .pos-item svg { width: 18px; height: 18px; }
</style><style id="safe-overrides-step2">
/* Step 2: minor spacing polish, no layout change */
.toolbar .actions-right,
.toolbar .tools-right { gap: 8px; }
</style><style id="safe-overrides-step3">
/* Step 3: Polish — badges, icons, focus */
.badge.high, .badge.medium, .badge.low { border-color: var(--brand) !important; }
/* Keep backgrounds as defined elsewhere; only border is unified */

/* Global icon sizing in UI (non-invasive; small upper bound) */
.toolbar svg, .kpis svg, .filters svg, .actions-right svg, .tools-right svg {
  max-width: 20px; max-height: 20px;
}

/* Subtle accessible focus using brand hue */
:focus-visible {
  outline: 3px solid rgba(244,124,38,0.5);
  outline-offset: 2px;
}
</style><style id="safe-overrides-step4">
/* Step 4: Print & responsive (non-invasive) */

/* Print: repeat table headers and hide interactive chrome */
@media print {
  thead { display: table-header-group; }
  tfoot { display: table-footer-group; }
  .toolbar, .filters, .kpis, .actions-right, .tools-right, .skills-container,
  button, .btn, [role="button"] { display: none !important; }
  a[href]:after { content: ""; } /* no URL after links */
  .table, table { page-break-inside: auto; }
  tr, td, th { page-break-inside: avoid; page-break-after: auto; }
}

/* Responsive: ensure Position Skills doesn't overlap on small screens */
@media (max-width: 768px) {
  #dash { flex-wrap: wrap; gap: 8px; }
  #btn-skills { margin-bottom: 6px; }
}
</style><style id="safe-overrides-step5-vars">
/* Step 5: Centralized brand palette */
:root{
  --brand-red: #E1261C;
  --brand-orange: #F47C26;
  --brand-black: #000000;
  --brand-white: #ffffff;
}
/* Use variables for the Position Skills button */
.btn--skills{ background: var(--brand-red); color: var(--brand-white); border-color: var(--brand-red); }
</style><style id="safe-overrides-step8">
/* Step 8: Subtle interactive feedback (no layout change) */
.btn, button, [role="button"] {
  transition: background-color .2s ease, box-shadow .2s ease, transform .05s ease;
}
a { transition: color .2s ease, text-decoration-color .2s ease; }

/* Hover states */
.btn:hover, button:hover, [role="button"]:hover {
  box-shadow: 0 2px 10px rgba(0,0,0,.08);
}
.btn--skills:hover {
  background: rgba(225,38,28,0.92);
  border-color: rgba(225,38,28,0.92);
}

/* Active press feedback */
.btn:active, button:active, [role="button"]:active {
  transform: translateY(1px);
}

/* Link hover underline appears smoothly */
a:hover { text-decoration: underline; text-decoration-color: currentColor; }

/* High-contrast focus fallback */
.btn:focus-visible, button:focus-visible, [role="button"]:focus-visible, a:focus-visible {
  outline: 3px solid rgba(244,124,38,0.5);
  outline-offset: 2px;
}
</style><style id="safe-overrides-step10">
/* Step 10: Consolidation — reusable base classes (non-invasive) */

/* Button base & variants */
.btn { 
  border-radius: 12px;
  font-weight: 700;
  transition: background-color .2s ease, box-shadow .2s ease, transform .05s ease;
}
.btn--primary {
  background: var(--brand);
  color: var(--brand-white);
  border-color: var(--brand);
}
.btn--outline {
  background: var(--brand-white);
  color: var(--brand);
  border-color: var(--brand);
}

/* Card/panel base */
.card, .panel {
  border-radius: 14px;
  box-shadow: 0 24px 80px rgba(0,0,0,.05);
}

/* Utilities */
.u-flex { display:flex; }
.u-center { align-items:center; justify-content:center; }
.u-gap-8 { gap: 8px; }
.u-gap-12 { gap: 12px; }
.u-mt-8 { margin-top: 8px; }
.u-mt-16 { margin-top: 16px; }
.u-mb-8 { margin-bottom: 8px; }
.u-mb-16 { margin-bottom: 16px; }
</style><style id="safe-overrides-step11">
/* Step 11: Responsive refinements */
/* Small phones */
@media (max-width: 600px) {
  /* Stack header actions nicely */
  #dash, .toolbar, .actions-right, .tools-right { 
    flex-wrap: wrap; 
    gap: 8px; 
  }

  /* Make key buttons easier to tap */
  .toolbar .btn, #dash .btn, .kpis .btn {
    min-height: 40px;
    padding: 10px 14px;
  }

  /* Position Skills stays readable */
  #btn-skills { width: 100%; }

  /* Tables: allow horizontal scroll without breaking layout */
  table { 
    display: block; 
    width: 100%; 
    overflow-x: auto; 
    -webkit-overflow-scrolling: touch; 
    border-collapse: separate; 
    border-spacing: 0;
  }
  thead, tbody, tfoot { width: 100%; }
  tr { width: max-content; }

  /* Modals/panels: fit viewport width comfortably */
  .panel { 
    width: 94vw !important; 
    max-width: 560px !important; 
    box-sizing: border-box;
  }
}

/* Tablets */
@media (min-width: 601px) and (max-width: 900px) {
  #dash { flex-wrap: wrap; gap: 8px; }
  #btn-skills { width: auto; }
  .panel { max-width: 640px; }
}
</style><style id="safe-overrides-step12">
/* Step 12: Pop-up clarity with backdrop blur */
#skills-modal,
#skills-positions {
  /* keep high z-index from previous steps */
  background: rgba(0,0,0,0.45);                 /* fallback */
  -webkit-backdrop-filter: blur(4px) saturate(110%);
  backdrop-filter: blur(4px) saturate(110%);
  transition: background .2s ease;
}
#skills-modal .panel,
#skills-positions .panel {
  /* gentle elevation */
  box-shadow: 0 24px 80px rgba(0,0,0,.35);
  border-radius: 14px;
}
/* Optional: small fade-in when displayed (works once display != none) */
#skills-modal[style*="display: flex"],
#skills-positions[style*="display: flex"] {
  animation: modalFadeIn .18s ease-out both;
}
@keyframes modalFadeIn {
  from { opacity: 0; transform: translateY(6px); }
  to   { opacity: 1; transform: translateY(0); }
}
</style><style id="safe-overrides-step13">
/* Step 13: Position list micro-interactions */
.pos-item {
  cursor: pointer;
  transition: background-color .15s ease, box-shadow .15s ease, transform .05s ease;
}
.pos-item:hover {
  background: var(--brand-06, rgba(244,124,38,0.06));
  box-shadow: 0 6px 20px rgba(0,0,0,.08);
}
.pos-item:active {
  transform: translateY(1px);
}
</style><style id="safe-overrides-step14">
/* Step 14: Animated reveal for skills in the competencies modal */
#skills-list li {
  opacity: 0;
  transform: translateY(6px);
  animation: skillItemIn .22s ease-out forwards;
  will-change: opacity, transform;
}
#skills-list li:nth-child(1) { animation-delay: .02s; }
#skills-list li:nth-child(2) { animation-delay: .05s; }
#skills-list li:nth-child(3) { animation-delay: .08s; }
#skills-list li:nth-child(4) { animation-delay: .11s; }
#skills-list li:nth-child(5) { animation-delay: .14s; }

/* Subtle pop for the SVG icon within each skill item */
#skills-list li svg {
  transform: scale(.92);
  animation: skillIconPop .22s ease-out forwards;
  animation-delay: inherit; /* match the li's delay */
  will-change: transform;
}

/* Optional: a small pulsing glow around the icon on first appear */
#skills-list li svg { filter: drop-shadow(0 0 0 rgba(244,124,38,0)); }
#skills-list li svg.appear-glow { animation: skillIconGlow 1s ease-out 1; }

@keyframes skillItemIn {
  from { opacity: 0; transform: translateY(6px); }
  to   { opacity: 1; transform: translateY(0); }
}
@keyframes skillIconPop {
  from { transform: scale(.92); }
  to   { transform: scale(1); }
}
@keyframes skillIconGlow {
  0%   { filter: drop-shadow(0 0 0 rgba(244,124,38,0)); }
  40%  { filter: drop-shadow(0 0 6px rgba(244,124,38,.35)); }
  100% { filter: drop-shadow(0 0 0 rgba(244,124,38,0)); }
}

/* Respect reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  #skills-list li,
  #skills-list li svg {
    animation: none !important;
    transform: none !important;
  }
}
</style><style id="toolbar-uniform-sizing">
/* Uniform sizing for primary toolbar buttons */
.toolbar .actions-right .btn,
.toolbar .tools-right .btn,
.toolbar .btn {
  min-height: 36px;
  padding: 8px 14px;
  border-radius: 12px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
</style><style id="design-align-v1">
/* Visual alignment & consistency (CSS-only) */
:root{
  --container-max: 1320px;
  --container-pad: 16px;
  --gap-8: 8px;
  --gap-12: 12px;
}

/* Align major sections to a common grid */
#appHeader,
.wrap,
.content,
.toolbar,
.kpis,
#dash,
#filtersBar{
  max-width: var(--container-max);
  margin-left: auto;
  margin-right: auto;
  padding-left: var(--container-pad);
  padding-right: var(--container-pad);
}

/* Consistent gaps */
.kpis{ gap: var(--gap-12); }
.toolbar .actions-right,
.toolbar .tools-right{ gap: var(--gap-8); }

/* Uniform buttons in toolbar and KPI */
.toolbar .btn,
.kpis .btn{
  min-height: 36px;
  padding: 8px 14px;
  border-radius: 12px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

/* Make Show/Hide Description visually identical to others (final safeguard) */
#btn-desc.btn{
  font-weight: inherit;
}

/* Table readability preserved (no logic change) */
table thead th{ vertical-align: middle; }
</style><style id="design-tokens-polish">
/* === Design Tokens & Polish (CSS-only, no logic changes) === */
:root{
  /* Spacing */
  --space-8: 8px; --space-12: 12px; --space-16: 16px; --space-24: 24px;
  /* Radii */
  --radius-12: 12px; --radius-14: 14px;
  /* Colors */
  --brand-red: #E1261C;
  --brand-orange: #F47C26;
  --brand-06: rgba(244,124,38,0.06);
  --brand-12: rgba(244,124,38,0.12);
  --ink: #111111;
  --line: rgba(0,0,0,0.08);
  /* Shadows */
  --elev-1: 0 2px 10px rgba(0,0,0,0.08);
  --elev-2: 0 24px 80px rgba(0,0,0,0.10);
}

/* Buttons – levels */
.btn--skills,
button.btn--skills{
  background: var(--brand-red);
  border-color: var(--brand-red);
  color: #fff;
}
.btn--skills:hover{ box-shadow: var(--elev-1); transform: translateY(0); }

/* Toolbar & KPI uniformity */
.toolbar .btn, .kpis .btn{
  min-height: 36px;
  padding: 8px 14px;
  border-radius: var(--radius-12);
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: background-color .2s ease, box-shadow .2s ease, transform .05s ease;
}
.toolbar .btn:hover, .kpis .btn:hover{ box-shadow: var(--elev-1); }
.toolbar .btn:active, .kpis .btn:active{ transform: translateY(1px); }

/* KPI trio “suite look” */
.kpis{ gap: var(--space-12); }
.kpis .btn{ border-radius: var(--radius-12); }

/* Badges HIGH/MED/LOW – consistent border & subtle backgrounds */
.badge.high, .badge.medium, .badge.low{ border-color: var(--brand-orange); }
.badge.high{ background: var(--brand-12); }
.badge.medium{ background: var(--brand-06); }
.badge.low{ background: transparent; }

/* Sidenav / Processes: alignment and highlight */
.sidenav button, .sidenav .btn{
  display: flex; align-items: center; gap: 8px;
  padding: 12px 14px;
  border-radius: var(--radius-12);
}
.sidenav button svg, .sidenav .btn svg{ width: 18px; height: 18px; }
.sidenav .btn:hover{ background: var(--brand-06); }
.sidenav .btn.active, .sidenav .btn.is-active, .sidenav .btn[aria-current="true"]{
  background: var(--brand-06);
  box-shadow: inset 3px 0 0 var(--brand-orange);
}

/* Table – sticky header and optional first column */
table{ border-collapse: separate; border-spacing: 0; }
table thead th{
  position: sticky; top: 0; z-index: 2;
  background: #fff;
}
/* Optional sticky first column – safe default */
table th:first-child, table td:first-child{
  position: sticky; left: 0; z-index: 1;
  background: #fff;
  box-shadow: inset -1px 0 0 var(--line);
}

/* Stripe, divider & hover are preserved/enhanced */
table tbody tr:nth-child(even){ background: var(--brand-06); }
table tbody tr + tr{ border-top: 1px solid var(--line); }
table tbody tr:hover{ background: var(--brand-12); }

/* Modal content readability */
#skills-list{ max-width: 70ch; }
#skills-list li{ margin-bottom: var(--space-8); }
#skills-list li svg{ margin-right: 8px; }

/* Empty state as card */
.empty-state{
  margin: 12px 0; padding: 12px 14px;
  border: 1px solid var(--line);
  border-radius: var(--radius-12);
  background: #fff;
  color: rgba(0,0,0,0.7);
}

/* General typography alignment */
body, td, th, button, .btn{ color: var(--ink); }
</style><style id="design-tokens-next">
:root{
  --space-6: 6px; --space-8: 8px; --space-12: 12px; --space-16: 16px; --space-24: 24px;
  --radius-10: 10px; --radius-12: 12px; --radius-14: 14px;
  --brand-red: #E1261C; --brand-orange: #F47C26;
  --brand-06: rgba(244,124,38,0.06); --brand-12: rgba(244,124,38,0.12);
  --ink: #111; --line: rgba(0,0,0,.08);
  --elev-1: 0 2px 10px rgba(0,0,0,.08); --elev-2: 0 24px 80px rgba(0,0,0,.10);
  --container-max: 1320px; --container-pad: 16px;
}
</style><style id="design-align-next">
/* Align major sections to a common grid */
#appHeader, .wrap, .content, .toolbar, .kpis, #dash, #filtersBar{
  max-width: var(--container-max);
  margin-left: auto; margin-right: auto;
  padding-left: var(--container-pad); padding-right: var(--container-pad);
}
/* Consistent gaps */
.kpis{ gap: var(--space-12); }
.toolbar .actions-right, .toolbar .tools-right{ gap: var(--space-8); }
</style><style id="btn-uniform-next">
.toolbar .btn, .kpis .btn{
  min-height: 36px; padding: 8px 14px; border-radius: var(--radius-12);
  display: inline-flex; align-items: center; gap: 6px;
  transition: background-color .2s ease, box-shadow .2s ease, transform .05s ease;
}
.toolbar .btn:hover, .kpis .btn:hover{ box-shadow: var(--elev-1); }
.toolbar .btn:active, .kpis .btn:active{ transform: translateY(1px); }
.btn--skills{ background: var(--brand-red); color: #fff; border-color: var(--brand-red); }
</style><style id="table-polish-next">
table{ border-collapse: separate; border-spacing: 0; table-layout: fixed; }
table thead th{ position: sticky; top: 0; z-index: 2; background: #fff; }
table th:first-child, table td:first-child{ position: sticky; left: 0; z-index: 1; background: #fff; box-shadow: inset -1px 0 0 var(--line); }
table tbody tr:nth-child(even){ background: var(--brand-06); }
table tbody tr + tr{ border-top: 1px solid var(--line); }
table tbody tr:hover{ background: var(--brand-12); }
</style><style id="modal-polish-next">
/* Backdrop blur & elevation (works when modal overlay is visible) */
#skills-modal, #skills-positions, #tmgr-overlay {
  background: rgba(0,0,0,.45);
  -webkit-backdrop-filter: blur(4px) saturate(110%);
  backdrop-filter: blur(4px) saturate(110%);
}
#skills-modal .panel, #skills-positions .panel, #tmgr-overlay .panel{
  box-shadow: 0 24px 80px rgba(0,0,0,.35);
  border-radius: var(--radius-14);
}
</style><style id="desc-typography-next">
/* Description column unified */
td.desc, .task-desc, td[data-col="description"], .col-desc {
  font-size: 14px; line-height: 1.5; color: var(--ink);
  vertical-align: top; word-break: break-word; overflow-wrap: anywhere; hyphens: auto; text-wrap: pretty;
}
td.desc p, .task-desc p, td[data-col="description"] p, .col-desc p { margin: 0 0 8px; }
td.desc ul, .task-desc ul, td[data-col="description"] ul, .col-desc ul { margin: 0 0 8px 18px; padding: 0; list-style: disc outside; }
td.desc li, .task-desc li, td[data-col="description"] li, .col-desc li { margin: 0 0 4px; }
td.desc code, .task-desc code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 13px; background: rgba(0,0,0,.04); border-radius: 6px; padding: 0 4px; }
td.desc .desc-box{ position: relative; max-height: none; overflow: visible; }
td.desc .desc-box.collapsed{ max-height: 120px; overflow: hidden; }
td.desc .desc-box.collapsed::after{ content: ""; position: absolute; left: 0; right: 0; bottom: 0; height: 36px; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,1)); }
td.desc .desc-toggle{ margin-top: 6px; display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 10px; border: 1px solid var(--line); background: #fff; font-size: 12px; cursor: pointer; transition: background-color .15s ease, box-shadow .15s ease; }
td.desc .desc-toggle:hover{ box-shadow: var(--elev-1); }
td.desc .desc-toggle[aria-expanded="true"]{ background: var(--brand-06); }
td.desc p.keyline { margin: 0 0 6px; }
td.desc p.keyline strong { font-weight: 600; margin-right: 6px; }
td.desc li .chk { display:inline-block; width:14px; height:14px; border:1px solid var(--line); border-radius:3px; margin-right:6px; vertical-align:-2px; background:#fff; }
td.desc li .chk.on { background: var(--brand-06); box-shadow: inset 0 0 0 2px var(--brand-orange); }

/* 3) Toolbar look: subtle surface */
.toolbar {
  background: #fff;
  border-bottom: 1px solid var(--line, rgba(0,0,0,.08));
}
.toolbar .actions-right, .toolbar .tools-right { gap: 8px; }

/* 4) Buttons — consistent & impactful */
.btn, button {
  border-radius: 12px;
  min-height: 36px;
  padding: 8px 14px;
  display: inline-flex; align-items: center; gap: 6px;
  font-weight: 600;
  letter-spacing: .2px;
  transition: background-color .2s ease, box-shadow .2s ease, transform .05s ease, border-color .2s ease;
  border: 1px solid rgba(0,0,0,.10);
  background: #fff;
}
.btn:hover, button:hover { box-shadow: 0 2px 10px rgba(0,0,0,.08); }
.btn:active, button:active { transform: translateY(1px); }

/* Primary CTA */
.btn--skills {
  background: linear-gradient(135deg, var(--brand-red, #E1261C), #C91F18);
  color: #fff;
  border-color: #C91F18;
}
.btn--skills:hover { box-shadow: 0 8px 24px rgba(225,38,28,.18); }
.btn--skills:active { transform: translateY(1px); }

/* Secondary / Outline */
.btn--secondary, .btn-outline, .toolbar .btn {
  background: #fff;
  color: var(--ink, #111);
  border-color: rgba(0,0,0,.14);
}
.btn--secondary:hover, .btn-outline:hover, .toolbar .btn:hover {
  background: #fff;
  border-color: rgba(0,0,0,.2);
  box-shadow: 0 2px 10px rgba(0,0,0,.08);
}

/* Destructive (if any existing) */
.btn--danger { background: #E5484D; color: #fff; border-color: #D03C41; }

/* Disabled state */
.btn[disabled], button[disabled] { opacity: .55; cursor: not-allowed; box-shadow: none; transform: none; }

/* 5) KPI group — suite look */
.kpis { gap: 12px; padding: 8px 16px; }
.kpis .btn {
  border-radius: 12px;
  font-weight: 700;
  background: #fff;
}
.kpis .btn:hover { box-shadow: 0 2px 10px rgba(0,0,0,.08); }

/* 6) Sidenav — professional highlight */
.sidenav .btn, .sidenav button {
  display: flex; align-items: center; gap: 8px;
  padding: 12px 14px;
  border-radius: 12px;
  border: 1px solid transparent;
  background: #fff;
}
.sidenav .btn:hover { background: var(--brand-06, rgba(244,124,38,.06)); }
.sidenav .btn.active, .sidenav .btn.is-active, .sidenav .btn[aria-current="true"] {
  background: var(--brand-06, rgba(244,124,38,.06));
  border-color: var(--brand-orange, #F47C26);
  box-shadow: inset 3px 0 0 var(--brand-orange, #F47C26);
}
.sidenav .btn svg { width: 18px; height: 18px; }

/* 7) Table — clean enterprise look */
table { border-collapse: separate; border-spacing: 0; table-layout: fixed; background: #fff; }
table thead th {
  position: sticky; top: 0; z-index: 2;
  background: #fff;
  border-bottom: 1px solid var(--line, rgba(0,0,0,.08));
  font-weight: 700;
}
table th:first-child, table td:first-child {
  position: sticky; left: 0; z-index: 1;
  background: #fff;
  box-shadow: inset -1px 0 0 var(--line, rgba(0,0,0,.08));
}
table tbody tr:nth-child(even){ background: var(--brand-06, rgba(244,124,38,.06)); }
table tbody tr + tr { border-top: 1px solid var(--line, rgba(0,0,0,.08)); }
table tbody tr:hover { background: var(--brand-12, rgba(244,124,38,.12)); }

/* 8) Panels / cards / modals */
.panel, .card {
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 24px 80px rgba(0,0,0,.10);
}
#skills-modal, #skills-positions, #tmgr-overlay {
  background: rgba(0,0,0,0.45);
  -webkit-backdrop-filter: blur(4px) saturate(110%);
  backdrop-filter: blur(4px) saturate(110%);
}

/* 9) Description readability */
td.desc, .task-desc, td[data-col="description"], .col-desc {
  font-size: 14px; line-height: 1.5; color: var(--ink, #111);
  vertical-align: top; word-break: break-word; overflow-wrap: anywhere; hyphens: auto; text-wrap: pretty;
}
td.desc p { margin: 0 0 8px; }
td.desc ul { margin: 0 0 8px 18px; padding: 0; list-style: disc outside; }
td.desc li { margin: 0 0 4px; }
td.desc code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 13px; background: rgba(0,0,0,.04); border-radius: 6px; padding: 0 4px; }
td.desc .desc-box{ position: relative; max-height: none; overflow: visible; }
td.desc .desc-box.collapsed{ max-height: 120px; overflow: hidden; }
td.desc .desc-box.collapsed::after{ content: ""; position: absolute; left: 0; right: 0; bottom: 0; height: 36px; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,1)); }
td.desc .desc-toggle{ margin-top: 6px; display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 10px; border: 1px solid var(--line); background: #fff; font-size: 12px; cursor: pointer; transition: background-color .15s ease, box-shadow .15s ease; }
td.desc .desc-toggle:hover{ box-shadow: 0 2px 10px rgba(0,0,0,.08); }
td.desc .desc-toggle[aria-expanded="true"]{ background: var(--brand-06); }
td.desc p.keyline { margin: 0 0 6px; }
td.desc p.keyline strong { font-weight: 600; margin-right: 6px; }
td.desc li .chk { display:inline-block; width:14px; height:14px; border:1px solid var(--line); border-radius:3px; margin-right:6px; vertical-align:-2px; background:#fff; }
td.desc li .chk.on { background: var(--brand-06); box-shadow: inset 0 0 0 2px var(--brand-orange); }
td.desc pre, td.desc code { overflow-x: auto; }
td.desc a { text-decoration: underline; }

/* 10) Optional dark mode (prefers-color-scheme) */
@media (prefers-color-scheme: dark){
  body { --app-bg: #0c0d10; --ink: #f2f4f7; --line: rgba(255,255,255,.12); }
  .toolbar, table, .panel, .card { background: #16181d; color: var(--ink); border-color: var(--line); }
  table thead th, table th:first-child, table td:first-child { background: #16181d; }
  table tbody tr:nth-child(even){ background: rgba(255,255,255,.04); }
  table tbody tr:hover{ background: rgba(255,255,255,.08); }
  td.desc .desc-box.collapsed::after{
    background: linear-gradient(to bottom, rgba(22,24,29,0), rgba(22,24,29,1));
  }
  .btn, button { background: #20232a; color: var(--ink); border-color: var(--line); }
  .btn--skills { background: linear-gradient(135deg, #E1261C, #A4150E); border-color: #A4150E; }
  .sidenav .btn, .sidenav button { background: #20232a; }
}

/* 11) Focus visibility (consistent) */
.btn:focus-visible, button:focus-visible, a:focus-visible, [role="button"]:focus-visible {
  outline: 3px solid rgba(244,124,38,0.5);
  outline-offset: 2px;
}


/* === Fieldstar performance deck theme (black / yellow / orange) === */
:root{
  --deck-bg:#050505;
  --deck-panel:#090909;
  --deck-gold:#FFC400;
  --deck-orange:#FF5A1F;
  --deck-text:#F5F5F5;
  --deck-muted:#A3A3A3;
  --deck-line:#2B2B2B;
  --deck-shadow:0 16px 44px rgba(0,0,0,.45);
}
html,body{background:var(--deck-bg); color:var(--deck-text)}
body{
  background:
    radial-gradient(900px 500px at 90% -10%, rgba(255,90,31,.20), transparent 60%),
    radial-gradient(800px 500px at -10% 120%, rgba(255,196,0,.16), transparent 60%),
    var(--deck-bg);
}
.header{
  position:relative;
  overflow:hidden;
  background:linear-gradient(180deg, rgba(8,8,8,.98), rgba(8,8,8,.92));
  border:1px solid var(--deck-line);
  border-radius:14px;
  margin:10px 18px 0;
  box-shadow:var(--deck-shadow);
}
.header::before,
.header::after{
  content:"";
  position:absolute;
  right:-160px;
  top:-120px;
  width:480px;
  height:180px;
  transform:rotate(38deg);
  pointer-events:none;
}
.header::before{background:var(--deck-gold); opacity:.95}
.header::after{background:var(--deck-orange); top:40px; right:-130px; opacity:.92}
.brand,.filters,.wrap{position:relative; z-index:1}
.h1{color:var(--deck-text); font-size:34px; letter-spacing:.8px}
.h2{color:var(--deck-gold); font-size:13px; letter-spacing:.6px}
.hero-strip{display:flex; flex-wrap:wrap; gap:8px; margin-top:8px}
.hero-pill{
  border:1px solid #403100;
  background:linear-gradient(180deg, rgba(255,196,0,.16), rgba(255,196,0,.04));
  color:var(--deck-gold);
  border-radius:999px;
  padding:6px 12px;
  font-size:12px;
  font-weight:800;
}
.kpi,.badge{
  border:1px solid #4a3a00;
  background:linear-gradient(180deg, rgba(255,196,0,.16), rgba(255,196,0,.06));
  color:var(--deck-gold);
  box-shadow:none;
}
.filters{
  margin:12px 20px 0;
  padding:12px;
  border:1px solid var(--deck-line);
  border-radius:14px;
  background:linear-gradient(180deg,#0a0a0a,#080808);
  box-shadow:var(--deck-shadow);
}
.filters .input-group{display:flex!important}
.btn, select, input[type="search"]{
  border:1px solid #363636;
  border-radius:12px;
  background:#0d0d0d;
  color:var(--deck-text);
  text-transform:none;
  font-weight:700;
}
input[type="search"]::placeholder{color:#8c8c8c}
.btn.primary{
  border-color:#7f320f;
  background:linear-gradient(135deg,#ff7a2f,var(--deck-orange));
  color:#fff;
}
.btn:hover{filter:brightness(1.08)}
.wrap{max-width:1760px; padding:12px 20px 24px}
.sidenav,.content{
  border:1px solid var(--deck-line);
  border-radius:16px;
  background:linear-gradient(180deg,#0b0b0b,#080808);
  box-shadow:var(--deck-shadow);
}
.sidenav .ttl,.count{color:var(--deck-gold)}
.proc,.sub{
  border:1px solid #3b3b3b;
  background:#0f0f0f;
  color:var(--deck-text);
}
.proc:hover,.sub:hover{border-color:#5f5f5f}
.proc.active,.sub.active{
  background:linear-gradient(135deg,var(--deck-gold),#ffdf6b);
  color:#111;
  border-color:transparent;
}
.toolbar{
  border:1px solid #2f2f2f;
  border-radius:12px;
  background:#0d0d0d;
  padding:8px 10px;
}
.table{
  border:1px solid #2c2c2c;
  border-radius:14px;
  overflow:hidden;
  background:#0a0a0a;
}
.thead th{
  background:#0f0f0f;
  border-bottom:1px solid #2f2f2f;
  color:var(--deck-gold);
  font-size:12px;
}
.tbody td{border-bottom:1px solid #232323; color:var(--deck-text)}
.tbody tr:hover{box-shadow:inset 0 0 0 9999px rgba(255,196,0,.08)}
/* critical readability fix: first sticky task column was forced white by legacy styles */
table th:first-child, table td:first-child{
  background:#0b0b0b !important;
  box-shadow: inset -1px 0 0 #232323 !important;
}
.tbody tr:nth-child(even) td{background:rgba(255,255,255,.01)}
.tbody tr:nth-child(odd) td{background:transparent}
.row-high td{background:rgba(255,90,31,.10) !important}
.tbody td, .td-tight, .cell-task-desc, .desc-ul li{color:#f1f1f1 !important}
.desc-ul li::before{color:var(--deck-orange) !important}
.cell-task-title{color:#fff}
.cell-task-desc,.count,.h2{opacity:1}
.chip{
  border:1px solid #4a3a00;
  background:rgba(255,196,0,.08);
  color:var(--deck-gold);
}
.sub-header{
  border:1px solid #4a3a00;
  background:rgba(255,196,0,.08);
  color:var(--deck-gold);
}

/* --- usability + positioning corrections after review --- */
#appHeader,#filtersBar,.wrap,.content,.toolbar,.kpis,#dash{
  max-width: min(1760px, calc(100vw - 24px)) !important;
  padding-left:0 !important;
  padding-right:0 !important;
}
#appHeader{margin-left:auto; margin-right:auto}
#filtersBar{margin-left:auto; margin-right:auto; margin-bottom:10px}
.wrap{margin-top:0; gap:14px; align-items:start}
.header{padding:14px 18px 12px}
.brand{gap:12px; align-items:flex-start}
.logo{height:68px}
.h1{line-height:1.1}
.h2{margin-top:2px}
.dash{align-items:flex-start; gap:8px}
.filters .row{row-gap:8px}
.actions-right{display:flex; flex-wrap:wrap; gap:8px}
.count{font-size:12px; color:#eab308; letter-spacing:.03em}
.cell-task-title{font-weight:800; color:#fff}
.cell-task-desc,.desc-ul li{color:#d6d6d6; font-size:15px; line-height:1.55}
.badge.high{background:rgba(255,90,31,.2); color:#ffd2c0; border-color:#a63f1a}
.badge.med{background:rgba(255,196,0,.15); color:#ffe28a; border-color:#6d5200}
.badge.low{background:rgba(34,197,94,.16); color:#9af0be; border-color:#1f7a45}
.table{table-layout:fixed}
.td-tight{white-space:normal}
@media (max-width:1200px){
  .brand{flex-wrap:wrap}
  .dash{width:100%; justify-content:flex-start; margin-left:0}
}
@media (max-width:980px){
  .header{margin:8px 8px 0}
  .filters{margin:10px 8px 0; padding:10px}
  .wrap{padding:10px 8px 18px}
  .h1{font-size:28px}
}


</style></head>
<body>
<header class="header" id="appHeader">
<div class="brand">
<img alt="Fieldstar" class="logo" src="data:image/png;base64,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"/>
<div>
<div class="h1">EXTENDED SALES FORCE</div>
<div class="h2">ESF — TASK TREE</div>
<div class="hero-strip" role="note" aria-label="Platform highlights">
  <span class="hero-pill">⚡ 2026 Operations Cockpit</span>
  <span class="hero-pill">Realtime workflow visibility</span>
  <span class="hero-pill">Fast filters, executive-ready export</span>
</div>
<div aria-label="KPI filters" class="kpis" id="kpis" role="region"></div>
</div>
<div aria-hidden="true" aria-label="Dash filters" class="dash" id="dash" role="region">
<div class="skills-container" style="position:relative;">
<button aria-label="Open Position Skills" class="btn btn--skills" id="btn-skills">POSITION SKILLS</button>
</div>
<div class="badge high" id="kHigh"></div>
<div class="badge med" id="kMed"></div>
<div class="badge low" id="kLow"></div>
</div>
</div>
</header>
<section aria-label="Filters &amp; Search" class="filters" id="filtersBar">
<div class="row">
<div class="input-group">
<input aria-label="Search tasks, owners, execution roles, descriptions" id="q" placeholder="Search tasks, owners, execution roles, descriptions…" type="search"/>
<button class="btn primary" id="btn-search">Search</button>
</div>
<select aria-label="Filter by Position" id="f-position"><option value="">Position (all)</option></select>
<select aria-label="Filter by Process" id="f-process"><option value="">Process (all)</option></select>
<select aria-label="Filter by Sub-process" id="f-sub"><option value="">Sub-process (all)</option></select>
<select aria-label="Filter by Importance" id="f-imp"><option value="">Importance (all)</option></select>
<select aria-label="Filter by Frequency" id="f-freq"><option value="">Frequency (all)</option></select>
<div class="actions-right">
<button class="btn" id="btn-clear">Clear All</button>
<button class="btn" id="btn-export">Export Excel</button>
<button class="btn" id="btn-desc">HIDE DESCRIPTION</button>
<button class="btn" id="btn-validate">Data Check</button>
</div>
</div>
<div aria-live="polite" class="chips" id="chips"></div>
</section>
<div class="wrap">
<aside aria-label="Process Tree Navigation" class="sidenav">
<div class="ttl">Processes</div>
<ul class="tree" id="tree"></ul>
<div class="sidenav-footer">
<span class="pw">Powered by</span>
<img alt="Fieldstar" src="data:image/png;base64,..." />
</div>
</aside>
<section class="content">
<div aria-label="Toolbar actions" class="toolbar" role="region">
<div class="count" id="count"></div>
<div class="tools-right">
<button class="btn hidden" id="btn-help">Help</button></div>
</div>
<div class="sub-header" id="subHeader" style="display:none"></div>
<table aria-label="Tasks" class="table" role="table">
<colgroup>
<col class="col-task"/>
<col class="col-freq"/>
<col class="col-imp"/>
<col class="col-owner"/>
<col class="col-exec"/>
</colgroup>
<thead class="thead">
<tr>
<th><span>Task</span></th>
<th><span>Frequency</span></th>
<th><span>Importance</span></th>
<th><span>Owner</span></th>
<th><span>Execution Role</span></th>
</tr>
</thead>
<tbody class="tbody" id="tbody"></tbody>
</table>
</section>
</div>
<script>
  const PAYLOAD = {/* ... payload mare cu tasks/proceses/validation ... */};

  let PROCESSES = PAYLOAD.processes || [];
  const TASKS = PAYLOAD.tasks || [];
  const VALID  = PAYLOAD.validation || {};
  const el = s => document.querySelector(s);
  const els = s => Array.from(document.querySelectorAll(s));
  const toASCII = s => (s||"").normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  const canon = s => toASCII(String(s||'').toUpperCase());
  const escapeHtml = s => String(s||"").replace(/[&<>\"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));

  function calcStickyTop(){
    const h = el("#appHeader");
    const hH = (h?.getBoundingClientRect().height||120);
    document.documentElement.style.setProperty('--header-h', Math.round(hH)+'px');
    const f = el(".filters");
    const fH = (f?.getBoundingClientRect().height||96);
    const top = hH + fH;
    document.documentElement.style.setProperty('--thead-top', Math.round(top)+'px');
  }
  window.addEventListener("resize", calcStickyTop);
  window.addEventListener("load", calcStickyTop);

  function iconFor(pid){
    const s = (svg)=>`<span class="ico">${svg}</span>`;
    switch(pid){
      case 'human-resources': return s('<svg viewBox="0 0 24 24"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a6.5 6.5 0 0 1 13 0"/></svg>');
      case 'field-management': return s('<svg viewBox="0 0 24 24"><path d="M3 11l9-9 9 9"/><path d="M9 22V12h6v10"/></svg>');
      case 'account-management': return s('<svg viewBox="0 0 24 24"><rect x="3" y="7" width="18" height="13" rx="2"/><path d="M16 3H8v4h8z"/><path d="M7 13h4"/></svg>');
      case 'logistics': return s('<svg viewBox="0 0 24 24"><rect x="1" y="7" width="15" height="10" rx="2"/><path d="M16 13h3l3 4v-7h-6z"/><circle cx="7" cy="19" r="2"/><circle cx="18" cy="19" r="2"/></svg>');
      case 'asset-workforce-support': return s('<svg viewBox="0 0 24 24"><path d="M12 2v4"/><path d="M12 18v4"/><path d="M4.93 4.93l2.83 2.83"/><path d="M16.24 16.24l2.83 2.83"/><circle cx="12" cy="12" r="3"/></svg>');
      default: return s('<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M3 3l18 18"/></svg>');
    }
  }

  function getFrequenciesFromTasks() {
    const freqs = new Set();
    PAYLOAD.tasks.forEach(t => {
      if (t.frequency && String(t.frequency).trim() !== '') {
        freqs.add(t.frequency.trim());
      }
    });
    return Array.from(freqs).sort((a,b) => a.localeCompare(b));
  }

  function getImportanceList() {
    return ['HIGH', 'MED', 'LOW'];
  }

  function buildKPIs(filteredCounts){
    const k = el("#kpis");
    if(k) k.innerHTML = `<div class="kpi"><strong>${TASKS.length}</strong>&nbsp;TASKS</div>`;
    const {high=0,med=0,low=0} = filteredCounts||{};
    const tot = (high+med+low)||TASKS.length;
    const P = n => !tot ? "0%" : Math.round(n/tot*100) + "%";
    el("#kHigh").textContent = `HIGH ${high} (${P(high)})`;
    el("#kMed").textContent  = `MEDIUM ${med} (${P(med)})`;
    el("#kLow").textContent  = `LOW ${low} (${P(low)})`;
  }
  function buildTree(){
    const t = el("#tree");
    if(!t) return;
    t.innerHTML = PROCESSES.map(p=>{
      const subs = (p.subs||[]).map(s=>`<li class="node"><a class="sub" tabindex="0" data-proc="${p.id}" data-sub="${s}">${s}</a></li>`).join('');
      return `<li class="node">
        <div class="proc" tabindex="0" data-proc="${p.id}">${iconFor(p.id)}<span>${p.name}</span></div>
        <ul class="subs" id="subs-${p.id}">${subs}</ul>
      </li>`;
    }).join("");

    els(".proc").forEach(pr=>{
      pr.addEventListener("click", ()=>toggleProc(pr));
      pr.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); toggleProc(pr);} });
    });
    els(".sub").forEach(sb=>{
      sb.addEventListener("click", ()=>selectSub(sb));
      sb.addEventListener("keydown", (e)=>{ if(e.key==="Enter"||e.key===" "){ e.preventDefault(); selectSub(sb);} });
    });
  }

  function toggleProc(pr){
    const pid = pr.getAttribute("data-proc");
    const box = el("#subs-"+pid);
    const open = box && box.style.display!=="block";
    els(".subs").forEach(x=> x.style.display="none");
    if(open && box){ box.style.display="block"; }
    state.process = pid; state.subproc = null;
    els(".proc").forEach(x=> x.classList.toggle("active", x===pr));
    els(".sub").forEach(x=> x.classList.remove("active"));
    updateSubHeader(); applyFilters(); pushHash();
  }

  function selectSub(sb){
    els(".sub").forEach(x=> x.classList.remove("active"));
    sb.classList.add("active");
    state.process = sb.getAttribute("data-proc");
    state.subproc = sb.getAttribute("data-sub");
    els(".proc").forEach(p=> p.classList.toggle("active", p.getAttribute("data-proc")===state.process));
    updateSubHeader(); applyFilters(); pushHash();
  }

  function fillSelects(){
    const positions = TASKS.map(x=>x.position).filter(Boolean);
    const owners    = TASKS.map(x=>x.owner).filter(Boolean);
    const execs     = TASKS.map(x=>x.exec).filter(Boolean);
    const freqsCanon = TASKS.map(x=>canon(x.freq)).filter(Boolean);
    function fill(sel, arr, label){ if(!sel) return; sel.innerHTML = `<option value="">${label}</option>` + [...new Set(arr)].sort((a,b)=>a.localeCompare(b,'en')).map(v=>`<option value="${v}">${v}</option>`).join(""); }
    fill(el("#f-pos"), positions, "POSITION");
    fill(el("#f-owner"), owners, "OWNER");
    fill(el("#f-exec"), execs, "EXECUTOR");
    const freqUnique = [...new Set(freqsCanon)];
    const freqLabel = v => ({"DAILY":"DAILY","WEEKLY":"WEEKLY","MONTHLY":"MONTHLY","QUARTERLY":"QUARTERLY","ANNUAL":"ANNUAL","ONGOING":"ONGOING"}[v]||v);
    const selFreq = el("#f-freq");
    if(selFreq) selFreq.innerHTML = `<option value="">FREQUENCY</option>` + freqUnique.sort().map(v=>`<option value="${v}">${freqLabel(v)}</option>`).join("");
  }

  function sentenceSplit(text){
    const out=[]; let buf='';
    const s = String(text||'').trim();
    for(let i=0;i<s.length;i++){ const ch=s[i]; buf+=ch; if(ch==='.'||ch===';'||ch===':'){ if(buf.trim().length>1){ out.push(buf.trim()); buf=''; } } }
    if(buf.trim()) out.push(buf.trim());
    return out;
  }
  function descParts(text){
    const raw = String(text||'').replace(/\r?\n/g,'\n').trim();
    if(!raw) return [];
    let norm = raw.replace(/[•\-–—]\s+/g,'\n');
    let parts = norm.split(/\n+/).map(s=>s.trim()).filter(Boolean);
    if(parts.length>1) return parts;
    parts = sentenceSplit(norm);
    if(parts.length>1) return parts.map(s=>s.replace(/[.;:]+$/,''));
    if(norm.length>160){
      const words = norm.split(/\s+/);
      let chunk=[], chunks=[];
      const sum = arr => arr.reduce((a,b)=>a+b.length+1,0);
      for(const w of words){ if(sum(chunk)+w.length > 140){ chunks.push(chunk.join(' ')); chunk=[w]; } else chunk.push(w); }
      if(chunk.length) chunks.push(chunk.join(' '));
      return chunks;
    }
    return [norm];
  }
  function descToBullets(text){
    const parts = descParts(text);
    if(!parts.length) return '';
    const twoCol = parts.length>=6 ? ' desc-ul two-col' : ' desc-ul';
    return '<ul class="'+twoCol.trim()+'">'+parts.map(p=>'<li>'+escapeHtml(p)+'</li>').join('')+'</ul>';
  }

  function updateChips(){
    const c = el("#chips"); if(!c) return;
    const chips = [];
    const f = state.filters;
    function addChip(label,key){
      const val = f[key]; if(!val) return;
      chips.push(`<span class="chip">${label}: ${escapeHtml(val)} <button data-key="${key}" title="Clear">×</button></span>`);
    }
    addChip("Position","pos");
    addChip("Owner","owner");
    addChip("Executor","exec");
    addChip("Importance","imp");
    addChip("Frequency","freq");
    if(state.query){ chips.push(`<span class="chip">Search: ${escapeHtml(state.query)} <button data-key="query" title="Clear">×</button></span>`); }
    c.innerHTML = chips.join("");
    c.querySelectorAll("button").forEach(b=>{
      b.addEventListener("click", ()=>{
        const k = b.getAttribute("data-key");
        if(k==="query"){ state.query=""; const q=el("#q"); if(q) q.value=""; }
        else { state.filters[k] = ""; const map = {pos:"#f-pos", owner:"#f-owner", exec:"#f-exec", imp:"#f-imp", freq:"#f-freq"}; const s = el(map[k]); if(s) s.value=""; }
        applyFilters(); pushHash();
      });
    });
  }

  function updateCount(n){ const c = el("#count"); if(c) c.textContent = (n||0) + " tasks shown"; }

  function listFiltered(){
    const q = (state.query||"").toLowerCase();
    const f = state.filters;
    let list = TASKS.slice();
    if(state.process) list = list.filter(x=> x.process===state.process);
    if(state.subproc) list = list.filter(x=> x.subproc===state.subproc);
    if(f.pos) list = list.filter(x=> x.position===f.pos);
    if(f.owner) list = list.filter(x=> x.owner===f.owner);
    if(f.exec) list = list.filter(x=> x.exec===f.exec);
    if(f.imp) list = list.filter(x=> (x.importance||"").toUpperCase()===f.imp);
    if(f.freq) list = list.filter(x=> canon(x.freq)===f.freq);
    if(q) list = list.filter(x=> (x.title+" "+x.desc+" "+x.position+" "+x.owner+" "+x.exec).toLowerCase().includes(q));
    return list;
  }

  function countsByImportance(list){
    const c = {high:0,med:0,low:0};
    list.forEach(t=>{
      const v=(t.importance||"").toUpperCase();
      if(v==="HIGH") c.high++; else if(v==="MEDIUM") c.med++; else if(v==="LOW") c.low++;
    });
    return c;
  }

  function rowHTML(t){
    const freqCanon = canon(t.freq);
    const freqHuman = {"DAILY":"DAILY","WEEKLY":"WEEKLY","MONTHLY":"MONTHLY","QUARTERLY":"QUARTERLY","ANNUAL":"ANNUAL","ONGOING":"ONGOING"}[freqCanon] || t.freq;
    const high = (t.importance||"").toUpperCase()==="HIGH";
    const desc = state.showDesc ? descToBullets(t.desc) : "";
    const title = escapeHtml(t.title);
    return `<tr class="${high?'row-high':''}">
      <td>
        <div class="cell-task-title" title="${title}">${title}</div>
        ${desc ? `<div class="cell-task-desc">${desc}</div>` : ""}
      </td>
      <td class="td-tight" title="${escapeHtml(freqHuman)}">${escapeHtml(freqHuman)}</td>
      <td class="td-tight" title="${escapeHtml((t.importance||"").toUpperCase())}"><span class="badge">${escapeHtml((t.importance||"").toUpperCase())}</span></td>
      <td class="td-tight" title="${escapeHtml(t.owner||"")}"><strong>${escapeHtml(t.owner||"")}</strong></td>
      <td class="td-tight" title="${escapeHtml(t.exec||"")}"><strong>${escapeHtml(t.exec||"")}</strong></td>
    </tr>`;
  }

  let state = { process:null, subproc:null, query:"", filters:{pos:"",owner:"",exec:"",imp:"",freq:""}, showDesc:true };
  function applyFilters(){
    const list = listFiltered();
    const tbody = el("#tbody"); if(!tbody) return;
    tbody.innerHTML = list.length ? list.map(rowHTML).join("") : `<tr><td colspan="5" id="empty" style="text-align:center;color:#777;padding:24px">No tasks for this selection.</td></tr>`;
    updateCount(list.length);
    updateChips();
    buildKPIs(countsByImportance(list));
  }
  function exportExcel(){
    const list = listFiltered();
    if(!list.length){ alert("Nothing to export. Adjust filters."); return; }
    const esc = s => String(s||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    const rows = list.map(t=> `<tr>
      <td>${esc(t.group)}</td>
      <td>${esc(t.subproc)}</td>
      <td>${esc(t.position)}</td>
      <td>${esc(t.title)}</td>
      <td>${esc(t.desc)}</td>
      <td>${esc(t.freq)}</td>
      <td>${esc(t.importance)}</td>
      <td>${esc(t.owner)}</td>
      <td>${esc(t.exec)}</td>
    </tr>`).join("");
    const html = `<!DOCTYPE html><html><head><meta charset="utf-8"><title>Export</title></head><body>
      <table border="1">
        <thead><tr><th>PROCESS</th><th>SUB-PROCESS</th><th>POSITION</th><th>KEY ACTIVITY</th><th>DESCRIPTION</th><th>FREQUENCY</th><th>IMPORTANCE</th><th>OWNER</th><th>EXECUTOR</th></tr></thead>
        <tbody>${rows}</tbody>
      </table></body></html>`;
    const blob = new Blob([html], {type: "application/vnd.ms-excel"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "ESF_Task_Tree_Export.xls";
    document.body.appendChild(a); a.click();
    setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 800);
  }

  function pushHash(){
    const f = state.filters;
    const obj = {p:state.process, s:state.subproc, q:state.query, fp:f.pos, fo:f.owner, fe:f.exec, fi:f.imp, ff:f.freq, d:state.showDesc?1:0};
    location.hash = encodeURIComponent(JSON.stringify(obj));
  }
  function readHash(){
    if(!location.hash) return;
    try{
      const obj = JSON.parse(decodeURIComponent(location.hash.slice(1)));
      state.process = obj.p||null; state.subproc = obj.s||null; state.query = obj.q||"";
      state.filters.pos = obj.fp||""; state.filters.owner=obj.fo||""; state.filters.exec=obj.fe||""; state.filters.imp=obj.fi||""; state.filters.freq=obj.ff||"";
      state.showDesc = obj.d?true:false;
      const q = el("#q"); if(q) q.value = state.query;
      ["#f-pos","#f-owner","#f-exec","#f-imp","#f-freq"].forEach((id,i)=>{
        const map = ["pos","owner","exec","imp","freq"][i]; const s=el(id); if(s) s.value = state.filters[map] || "";
      });
    }catch(e){}
  }

  function openHelp(open=true){ el("#help").style.display = open?"flex":"none"; }
  function openValidate(open=true){ 
    const box = el("#validate"); box.style.display = open?"flex":"none";
    if(open){
      const v = VALID || {};
      const lines = [];
      lines.push(`Tasks: ${v.totals?.tasks||0} (HIGH ${v.totals?.high||0}, MEDIUM ${v.totals?.med||0}, LOW ${v.totals?.low||0})`);
      lines.push(`Normalized frequency: ${v.freq_normalized||0}`);
      lines.push(`Normalized importance: ${v.importance_normalized||0}`);
      lines.push(`Typo fixes applied: ${v.typo_fixes||0}`);
      const miss = v.missing_critical||[];
      if(miss.length){ lines.push(`Missing critical fields (row): ${miss.slice(0,50).join(", ")}`); }
      const up = v.unknown_process||[];
      const us = v.unknown_subproc||[];
      if(up.length){ lines.push(`Unknown PROCESS (${up.length}):`); up.slice(0,50).forEach(x=> lines.push(`  - row ${x.row}: "${x.value}"`)); }
      if(us.length){ lines.push(`Unknown SUB-PROCESS (${us.length}):`); us.slice(0,50).forEach(x=> lines.push(`  - row ${x.row} [${x.process}]: "${x.value}"`)); }
      el("#valContent").innerHTML = "<pre>"+escapeHtml(lines.join("\n"))+"</pre>";
    }
  }

  function attachEvents(){
  const sPos = el("#f-pos");
  const sOwner = el("#f-owner");
  const sExec = el("#f-exec");
  const sFreq = el("#f-freq");
  const sImp = el("#f-imp");

  if (sPos) sPos.addEventListener("change", () => { state.filters.pos = sPos.value; applyFilters(); pushHash(); });
  if (sOwner) sOwner.addEventListener("change", () => { state.filters.owner = sOwner.value; applyFilters(); pushHash(); });
  if (sExec) sExec.addEventListener("change", () => { state.filters.exec = sExec.value; applyFilters(); pushHash(); });
  if (sFreq) sFreq.addEventListener("change", () => { state.filters.freq = sFreq.value; applyFilters(); pushHash(); });
  if (sImp) sImp.addEventListener("change", () => { state.filters.imp = sImp.value; applyFilters(); pushHash(); });
const btnSearch = el("#btn-search");
    const q = el("#q");
    const btnClear = el("#btn-clear");
    const btnCopy = el("#btn-copylink");
    const btnHelp = el("#btn-help");
    const help = el("#help"); const closeHelp = el("#close-help");
    const btnExport = el("#btn-export");
    const btnValidate = el("#btn-validate");
    const validate = el("#validate"); const closeValidate = el("#close-validate");
if(btnSearch) btnSearch.addEventListener("click", ()=>{ state.query=q.value.trim(); applyFilters(); pushHash(); });
    if(q) q.addEventListener("keydown", e=>{ if(e.key==="Enter"){ e.preventDefault(); btnSearch.click(); }});
    document.addEventListener("keydown", e=>{
      if(e.ctrlKey && e.key==="/"){ e.preventDefault(); q && q.focus(); }
      else if(e.key==="?" && !e.ctrlKey){ e.preventDefault(); openHelp(true); }
      else if(e.key==="Escape"){ openHelp(false); openValidate(false); }
    });

    if(btnHelp) btnHelp.addEventListener("click", ()=> openHelp(true));
    if(closeHelp) closeHelp.addEventListener("click", ()=> openHelp(false));
    if(help) help.addEventListener("click", (e)=>{ if(e.target===help) openHelp(false); });

    if(btnValidate) btnValidate.addEventListener("click", ()=> openValidate(true));
    if(closeValidate) closeValidate.addEventListener("click", ()=> openValidate(false));
    if(validate) validate.addEventListener("click", (e)=>{ if(e.target===validate) openValidate(false); });
if(btnCopy) btnCopy.addEventListener("click", async ()=>{
      try{ pushHash(); await navigator.clipboard.writeText(location.href); btnCopy.textContent="Copied!"; setTimeout(()=> btnCopy.textContent="Copy Link", 1200); }catch(e){ alert("Copy failed. Copy the URL manually."); }
    });

    if(btnClear) btnClear.addEventListener("click", ()=>{
      if(q) q.value="";
      state = { process:null, subproc:null, query:"", filters:{pos:"",owner:"",exec:"",imp:"",freq:""}, showDesc:true };
      els(".proc").forEach(x=> x.classList.remove("active"));
      els(".subs").forEach(x=> x.style.display="none");
      els(".sub").forEach(x=> x.classList.remove("active"));
      updateSubHeader(); applyFilters(); pushHash();
    });

    if(btnExport) btnExport.addEventListener("click", exportExcel);
  }

  function updateSubHeader(){
    const box = el("#subHeader");
    if(!box) return;
    if(!state.process){ box.style.display = "none"; return; }
    const procName = (PROCESSES.find(p=>p.id===state.process)||{}).name || "";
    const subName = state.subproc || "";
    box.textContent = subName ? `${procName} — ${subName}` : procName;
    box.style.display = "block";
  }

  function defaultOpen(){
    readHash();
    updateSubHeader(); applyFilters();
  }

  function init(){
    buildTree();
    fillSelects();
    attachEvents();
    calcStickyTop();
    defaultOpen(); // Neutral by default
    // Initial KPI render with whole dataset
    buildKPIs({high: (VALID?.totals?.high||0), med: (VALID?.totals?.med||0), low: (VALID?.totals?.low||0)});
  }
  document.addEventListener("DOMContentLoaded", init);
  const btnDesc = el("#btn-desc");
  if (btnDesc) {
    // set label according to current state on init
    btnDesc.textContent = state.showDesc ? "HIDE DESCRIPTION" : "SHOW DESCRIPTION";
    btnDesc.addEventListener("click", () => {
      state.showDesc = !state.showDesc;
      btnDesc.textContent = state.showDesc ? "HIDE DESCRIPTION" : "SHOW DESCRIPTION";
      applyFilters();
      if (typeof pushHash === "function") pushHash();
    });
  }

})();
